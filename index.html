<?php
session_start();
?>
<!DOCTYPE html>
<html lang="ro">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Găsește Hotelul Perfect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1a202c;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-md py-4">
        <div class="container mx-auto flex justify-between items-center px-6">
            <a href="index.html" class="text-3xl font-bold text-indigo-600">Hotel App</a>
            <nav>
                <!-- <a href="rezervare.html" class="text-gray-600 hover:text-indigo-600 font-medium px-4">Rezervă acum</a> -->
                <a href="login.html" class="text-gray-600 hover:text-indigo-600 font-medium px-4">Login
                    Administrator</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto mt-10 px-6 flex-grow">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Găsește Hotelul Perfect</h1>
        <p class="text-center text-gray-600 mb-12">Explorează colecția noastră de hoteluri și rezervă-ți vacanța de vis!
        </p>

        <!-- Dynamic Hotel List -->
        <div id="hotels-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Hotel cards will be dynamically inserted here -->
        </div>

        <!-- Message Box -->
        <div id="message-box"
            class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-white text-center py-3 px-6 rounded-lg shadow-lg z-50 transform scale-0 transition-transform duration-300 ease-in-out">
            <span id="message-text" class="text-gray-800 font-medium"></span>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-md mt-10 py-4">
        <div class="container mx-auto text-center text-gray-500 px-6">
            <p>&copy; 2024 Hotel App. Toate drepturile rezervate.</p>
        </div>
    </footer>
    <script>

        document.addEventListener('DOMContentLoaded', () => {
            fetchHotels();
        });

        async function fetchHotels() {
            try {
                const response = await fetch('api/get_hotels.php');
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                const hotelsContainer = document.getElementById('hotels-container');
                hotelsContainer.innerHTML = ''; // Curăță containerul

                if (data.length === 0) {
                    hotelsContainer.innerHTML = '<p class="text-center text-gray-500 text-lg col-span-full">Nu există hoteluri disponibile.</p>';
                    return;
                }

                const truncateLimit = 150; // Limita de caractere pentru descriere

                data.forEach(hotel => {
                    const description = hotel.description;
                    const needsTruncation = description.length > truncateLimit;
                    const truncatedDescription = needsTruncation
                        ? description.substring(0, truncateLimit) + '...'
                        : description;

                    const hotelCard = document.createElement('div');
                    hotelCard.className = "bg-white rounded-lg shadow-lg overflow-hidden transform transition-transform duration-300 hover:scale-105";

                    hotelCard.innerHTML = `
                <img src="${hotel.image_url}" alt="${hotel.name}" class="w-full h-48 object-cover">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-semibold text-gray-900">${hotel.name}</h3>
                        <span class="text-yellow-500 font-bold">${hotel.price} RON / noapte</span>
                    </div>
                    <p class="text-gray-600 text-sm mb-4">${hotel.location}</p>
                    <p class="text-gray-700 text-base mb-6">${truncatedDescription}</p>
                    ${needsTruncation ? `<button class="read-more-btn text-indigo-600 font-medium hover:underline focus:outline-none">Citește mai mult</button>` : ''}
                    <a href="rezervare.html?hotel_id=${hotel.id}" class="block w-full text-center bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 mt-4">
                        Rezervă acum
                    </a>
                </div>
            `;

                    hotelsContainer.appendChild(hotelCard);

                    if (needsTruncation) {
                        const readMoreBtn = hotelCard.querySelector('.read-more-btn');
                        const descriptionParagraph = hotelCard.querySelector('p:last-of-type');

                        readMoreBtn.addEventListener('click', () => {
                            if (descriptionParagraph.textContent.endsWith('...')) {
                                descriptionParagraph.textContent = description;
                                readMoreBtn.textContent = 'Citește mai puțin';
                            } else {
                                descriptionParagraph.textContent = truncatedDescription;
                                readMoreBtn.textContent = 'Citește mai mult';
                            }
                        });
                    }
                });

            } catch (error) {
                console.error("Eroare la încărcarea hotelurilor:", error);
                const hotelsContainer = document.getElementById('hotels-container');
                hotelsContainer.innerHTML = `<p class="text-center text-red-500 text-lg col-span-full">Eroare la încărcarea datelor: ${error.message}</p>`;
            }
        }

    </script>




</body>

</html>